
{% extends "base.html" %}
{% load static %}

{% block title %}Reports | ExpenseTracker{% endblock %}

{% block content %}
<div class="mb-4">
    <h1 class="fs-2 fw-bold mb-2">Reports</h1>
    <p class="text-muted">
        Analyze your spending patterns and track your financial goals
    </p>
</div>

<!-- Report Filters -->
<div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
        <form method="POST" class="row g-3 align-items-end">
            {% csrf_token %}
            <div class="col-md-4">
                <label class="form-label">Date Range</label>
                {{ date_form.start_date }}
            </div>
            <div class="col-md-4">
                <label class="form-label">To</label>
                {{ date_form.end_date }}
            </div>
            <div class="col-md-4">
                <button type="submit" class="btn btn-primary w-100">Apply Filters</button>
            </div>
        </form>
    </div>
</div>

<!-- Summary Cards -->
<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <h6 class="text-muted">Total Expenses</h6>
                <h3 class="fs-4">${{ total_expense }}</h3>
                <div class="progress mt-2" style="height: 5px;">
                    <div class="progress-bar bg-danger" role="progressbar" style="width: 100%"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <h6 class="text-muted">Total Income</h6>
                <h3 class="fs-4">${{ total_income }}</h3>
                <div class="progress mt-2" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 100%"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <h6 class="text-muted">Balance</h6>
                <h3 class="fs-4">${{ balance }}</h3>
                <div class="progress mt-2" style="height: 5px;">
                    <div class="progress-bar bg-primary" role="progressbar" style="width: 100%"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Report Tabs -->
<div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-white p-0">
        <ul class="nav nav-tabs" id="reportTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">Overview</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="categories-tab" data-bs-toggle="tab" data-bs-target="#categories" type="button" role="tab">Categories</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="trends-tab" data-bs-toggle="tab" data-bs-target="#trends" type="button" role="tab">Trends</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="calendar-tab" data-bs-toggle="tab" data-bs-target="#calendar" type="button" role="tab">Calendar</button>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content" id="reportTabsContent">
            <!-- Overview Tab -->
            <div class="tab-pane fade show active" id="overview" role="tabpanel">
                <div class="row">
                    <div class="col-lg-7">
                        <h5 class="mb-3">Expense Overview</h5>
                        <div class="chart-container">
                            <canvas id="trendChart" 
                                data-labels="{{ expenses_by_date.keys|safe }}"
                                data-values="{{ expenses_by_date.values|safe }}">
                            </canvas>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <h5 class="mb-3">Expense Distribution</h5>
                        <div class="chart-container">
                            <canvas id="categoryChart"
                                data-labels='["{{ category_data|map:"name"|join:'","'|safe }}"]' 
                                data-values='[{{ category_data|map:"amount"|join:","|safe }}]'>
                            </canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Categories Tab -->
            <div class="tab-pane fade" id="categories" role="tabpanel">
                <h5 class="mb-3">Expense Categories</h5>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Percentage</th>
                                <th>Progress</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for category in category_data %}
                                <tr>
                                    <td>{{ category.name }}</td>
                                    <td>${{ category.amount }}</td>
                                    <td>{{ category.percentage|floatformat:1 }}%</td>
                                    <td width="30%">
                                        <div class="progress">
                                            <div class="progress-bar" role="progressbar" 
                                                style="width: {{ category.percentage }}%"
                                                aria-valuenow="{{ category.percentage }}" 
                                                aria-valuemin="0" aria-valuemax="100">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center py-4">No category data available</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Trends Tab -->
            <div class="tab-pane fade" id="trends" role="tabpanel">
                <div class="chart-container">
                    <canvas id="trendChart" 
                        data-labels="{{ expenses_by_date.keys|safe }}"
                        data-values="{{ expenses_by_date.values|safe }}">
                    </canvas>
                </div>
            </div>
            
            <!-- Calendar Tab -->
            <div class="tab-pane fade" id="calendar" role="tabpanel">
                <div class="row">
                    <div class="col-md-6 mb-4 mb-md-0">
                        <div class="calendar-container p-3">
                            <!-- Calendar would be rendered here -->
                            <div class="text-center p-5 text-muted">
                                Calendar view will be displayed here
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="p-3 bg-light rounded">
                            <h5 id="selected-date" class="mb-3">Select a date</h5>
                            <div id="expense-details">
                                <div class="text-center py-4 text-muted">
                                    <p>Select a date to view expenses</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Transactions -->
<div class="card border-0 shadow-sm">
    <div class="card-header bg-white">
        <h5 class="mb-0">Recent Transactions</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Category</th>
                        <th>Date</th>
                        <th class="text-end">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in recent_transactions %}
                        <tr>
                            <td>{{ transaction.description }}</td>
                            <td>{{ transaction.category.name }}</td>
                            <td>{{ transaction.date }}</td>
                            <td class="text-end text-danger">${{ transaction.amount }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="4" class="text-center py-4">No recent transactions</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        initializeCharts();
    });
</script>
{% endblock %}
